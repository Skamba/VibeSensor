<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VibeSensor</title>
    <script type="module" crossorigin src="/assets/index-DOXENTib.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-CXx0AyVY.css">
  </head>
  <body>
    <div class="wrap">
      <header class="site-header">
        <div class="topbar">
          <h1 class="title" data-i18n="title.main">VibeSensor</h1>
          <div class="topbar-actions">
            <select id="languageSelect" class="lang-picker" aria-label="Language">
              <option value="en">ðŸ‡ºðŸ‡¸ English</option>
              <option value="nl">ðŸ‡³ðŸ‡± Nederlands</option>
            </select>
            <div id="linkState" class="pill pill--muted">Connecting...</div>
          </div>
        </div>

        <nav class="menu" aria-label="Primary" role="tablist">
          <button type="button" class="menu-btn active" data-view="dashboardView" id="tab-dashboard" role="tab" aria-controls="dashboardView" aria-selected="true" tabindex="0">
            <span data-i18n="nav.live">Live</span>
          </button>
          <button type="button" class="menu-btn" data-view="logsView" id="tab-logs" role="tab" aria-controls="logsView" aria-selected="false" tabindex="-1">
            <span data-i18n="nav.logs">Logs</span>
          </button>
          <button type="button" class="menu-btn" data-view="settingsView" id="tab-settings" role="tab" aria-controls="settingsView" aria-selected="false" tabindex="-1">
            <span data-i18n="nav.settings">Settings</span>
          </button>
        </nav>
      </header>

      <section id="dashboardView" class="view active" role="tabpanel" aria-labelledby="tab-dashboard">
        <div class="stat-grid">
          <div class="panel card stat" id="lastSeen">
            <div class="stat__label" data-i18n="status.last_seen_label">Last seen</div>
            <div class="stat__value" data-value>--</div>
          </div>
          <div class="panel card stat" id="dropped">
            <div class="stat__label" data-i18n="status.dropped_label">Dropped frames</div>
            <div class="stat__value" data-value>--</div>
          </div>
          <div class="panel card stat" id="framesTotal">
            <div class="stat__label" data-i18n="status.frames_total_label">Frames total</div>
            <div class="stat__value" data-value>--</div>
          </div>
        </div>

        <div class="dashboard-grid">
          <div class="panel card dashboard-grid__main">
            <div class="card__header">
              <div class="card__title" data-i18n="chart.spectrum_title">Multi-Sensor Blended Spectrum</div>
            </div>
            <div id="specChartWrap" class="spectrum-wrap">
              <div id="specChart"></div>
              <div id="spectrumOverlay" class="empty-state" hidden>Waiting for sensor data...</div>
            </div>
            <div id="legend" class="legend"></div>
            <div id="bandLegend" class="legend band-legend"></div>
            <div id="strengthChart" class="strength-chart"></div>
          </div>

          <div class="dashboard-grid__side">
            <div class="panel card">
              <div class="card__header">
                <div class="card__title" data-i18n="dashboard.run_logging">Run Logging</div>
              </div>
              <div class="logging-row">
                <span id="loggingStatus" class="pill pill--muted">Stopped</span>
              </div>
              <div class="logging-actions">
                <button id="startLoggingBtn" class="btn btn--success" data-i18n="dashboard.start_logging">Start Logging</button>
                <button id="stopLoggingBtn" class="btn btn--danger" data-i18n="dashboard.stop_logging">Stop Logging</button>
              </div>
              <div class="live-speed-readout">
                <div id="speed" class="speed">Speed --</div>
                <label class="mini-label" for="speedUnitSelect" data-i18n="speed.unit">Unit</label>
                <select id="speedUnitSelect" class="unit-picker" aria-label="Speed unit">
                  <option value="kmh" data-i18n="speed.unit.kmh">km/h</option>
                  <option value="mps" data-i18n="speed.unit.mps">m/s</option>
                </select>
              </div>
              <div class="live-speed-row">
                <label for="speedOverrideInput" data-i18n="dashboard.speed_override">Speed Override (km/h)</label>
                <input id="speedOverrideInput" type="number" step="0.1" min="0" />
                <button id="applySpeedOverrideBtn" class="btn btn--primary" data-i18n="dashboard.apply_override">Apply Override</button>
              </div>
              <div id="currentLogFile" class="card__subtle">Current file: --</div>
            </div>

            <div class="panel card">
              <div class="card__header">
                <div class="card__title" data-i18n="dashboard.detected_vibrations">Detected Vibrations</div>
              </div>
              <div id="vibrationLog" class="log-box"></div>
            </div>
          </div>

          <div class="panel card dashboard-grid__full">
            <div class="card__header">
              <div class="card__title" data-i18n="dashboard.vibration_count_live">Vibration Count Live</div>
            </div>
            <div class="matrix-note"><span data-i18n="dashboard.matrix_note">Levels use peak-over-floor dB bands (L1-L5), grouped by source type.</span></div>
            <div class="matrix-wrap">
              <table id="vibrationMatrix" class="vib-matrix"></table>
            </div>
          </div>
        </div>
      </section>

      <section id="logsView" class="view" role="tabpanel" aria-labelledby="tab-logs" hidden>
        <div class="panel card">
          <div class="log-actions">
            <div class="field">
              <label>&nbsp;</label>
              <button id="refreshLogsBtn" class="btn btn--primary" data-i18n="logs.refresh">Refresh Logs</button>
            </div>
            <div class="field">
              <label>&nbsp;</label>
              <button id="deleteAllLogsBtn" class="btn btn--danger" data-i18n="logs.delete_all" disabled>Delete All Logs</button>
            </div>
            <div class="field">
              <label>&nbsp;</label>
              <div id="logsSummary" class="subtle">No log files yet.</div>
            </div>
          </div>
          <table class="logs-table">
            <thead>
              <tr>
                <th data-i18n="logs.table.file">File</th>
                <th data-i18n="logs.table.updated">Updated</th>
                <th class="numeric" data-i18n="logs.table.size">Size</th>
                <th data-i18n="logs.table.actions">Actions</th>
              </tr>
            </thead>
            <tbody id="logsTableBody">
              <tr>
                <td colspan="4">No logs found.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="settingsView" class="view" role="tabpanel" aria-labelledby="tab-settings" hidden>
        <div class="panel card">
          <strong data-i18n="settings.client_locations">Client Locations</strong>
          <div class="subtle" data-i18n="settings.client_locations_hint">Set location and identify by client. Offline clients can still be assigned.</div>
          <table class="clients-table">
            <thead>
              <tr>
                <th data-i18n="settings.clients.client">Client</th>
                <th data-i18n="settings.clients.mac">MAC Address</th>
                <th data-i18n="settings.clients.location">Location</th>
                <th data-i18n="settings.clients.identify">Identify</th>
                <th data-i18n="settings.clients.remove">Remove</th>
              </tr>
            </thead>
            <tbody id="clientsSettingsBody">
              <tr>
                <td colspan="5">No clients detected yet.</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="panel card settings-layout">
          <div class="settings-groups">
            <section class="settings-group">
              <h3 data-i18n="settings.group.vehicle_setup">Vehicle Setup</h3>
              <div class="settings-subgrid">
                <div class="field"><label for="tireWidthInput" data-i18n="settings.tire_width">Tire Width (mm)</label><input id="tireWidthInput" type="number" min="100" step="1" /></div>
                <div class="field"><label for="tireAspectInput" data-i18n="settings.tire_aspect">Tire Aspect (%)</label><input id="tireAspectInput" type="number" min="20" step="1" /></div>
                <div class="field"><label for="rimInput" data-i18n="settings.rim_size">Rim Size (in)</label><input id="rimInput" type="number" min="10" step="0.5" /></div>
                <div class="field"><label for="finalDriveInput" data-i18n="settings.final_drive_ratio">Final Drive Ratio</label><input id="finalDriveInput" type="number" step="0.01" min="0.1" /></div>
                <div class="field"><label for="gearRatioInput" data-i18n="settings.current_gear_ratio">Current Gear Ratio</label><input id="gearRatioInput" type="number" step="0.01" min="0.1" /></div>
              </div>
            </section>

            <section class="settings-group">
              <h3 data-i18n="settings.group.order_band_widths">Order Band Widths</h3>
              <div class="settings-subgrid">
                <div class="field"><label for="wheelBandwidthInput" data-i18n="settings.wheel_bandwidth">Wheel Bandwidth (%)</label><input id="wheelBandwidthInput" type="number" step="0.1" min="1" max="40" /></div>
                <div class="field"><label for="driveshaftBandwidthInput" data-i18n="settings.driveshaft_bandwidth">Driveshaft Bandwidth (%)</label><input id="driveshaftBandwidthInput" type="number" step="0.1" min="1" max="40" /></div>
                <div class="field"><label for="engineBandwidthInput" data-i18n="settings.engine_bandwidth">Engine Bandwidth (%)</label><input id="engineBandwidthInput" type="number" step="0.1" min="1" max="40" /></div>
                <div class="field"><label for="minAbsBandHzInput" data-i18n="settings.min_half_width">Min Half-width (Hz)</label><input id="minAbsBandHzInput" type="number" step="0.1" min="0" max="10" /></div>
                <div class="field"><label for="maxBandHalfWidthInput" data-i18n="settings.max_half_width">Max Half-width (%)</label><input id="maxBandHalfWidthInput" type="number" step="0.1" min="1" max="25" /></div>
              </div>
            </section>

            <section class="settings-group">
              <h3 data-i18n="settings.group.uncertainty_model">Uncertainty Model</h3>
              <div class="subtle"><span data-i18n="settings.uncertainty_defaults">Defaults use tire wear from 10/32 in to 2/32 in plus safety margin.</span></div>
              <div class="settings-subgrid">
                <div class="field"><label for="speedUncertaintyInput" data-i18n="settings.speed_uncertainty">Speed Uncertainty (%)</label><input id="speedUncertaintyInput" type="number" step="0.1" min="0" max="20" /></div>
                <div class="field"><label for="tireDiameterUncertaintyInput" data-i18n="settings.tire_diameter_uncertainty">Tire Diameter Uncertainty (%)</label><input id="tireDiameterUncertaintyInput" type="number" step="0.1" min="0" max="20" /></div>
                <div class="field"><label for="finalDriveUncertaintyInput" data-i18n="settings.final_drive_uncertainty">Final Drive Uncertainty (%)</label><input id="finalDriveUncertaintyInput" type="number" step="0.1" min="0" max="10" /></div>
                <div class="field"><label for="gearUncertaintyInput" data-i18n="settings.gear_slip_uncertainty">Gear/Slip Uncertainty (%)</label><input id="gearUncertaintyInput" type="number" step="0.1" min="0" max="20" /></div>
              </div>
            </section>
          </div>
          <div class="settings-actions">
            <button id="saveSettingsBtn" class="btn btn--primary" data-i18n="settings.save">Save Settings</button>
          </div>
        </div>
      </section>
    </div>
    <div id="matrixTooltip" class="matrix-tooltip"></div>
    <div id="strengthTooltip" class="matrix-tooltip strength-tooltip"></div>

  </body>
</html>
