(() => {
  const supported = ["en", "nl"];

  const dict = {
    en: {
      "title.main": "VibeSensor Frequency Live",
      "nav.live": "Live",
      "nav.logs": "Logs",
      "nav.report": "Report",
      "nav.settings": "Settings",
      "dashboard.run_logging": "Run Logging",
      "dashboard.start_logging": "Start Logging",
      "dashboard.stop_logging": "Stop Logging",
      "dashboard.speed_override": "Speed Override (km/h)",
      "dashboard.apply_override": "Apply Override",
      "dashboard.detected_vibrations": "Detected Vibrations",
      "dashboard.vibration_count_live": "Vibration Count Live",
      "dashboard.matrix_note":
        "Levels use peak-over-floor dB bands (L1-L5), grouped by source type.",
      "logs.refresh": "Refresh Logs",
      "logs.table.file": "File",
      "logs.table.updated": "Updated",
      "logs.table.size": "Size",
      "logs.table.actions": "Actions",
      "logs.none": "No log files yet.",
      "logs.none_found": "No logs found.",
      "logs.available_count": "{count} log file(s) available",
      "logs.use_in_report": "Use In Report",
      "logs.raw": "Raw",
      "logs.delete": "Delete",
      "logs.no_available": "No logs available",
      "logs.delete_confirm": 'Delete log "{name}"? This cannot be undone.',
      "logs.delete_failed": "Failed to delete log.",
      "report.saved_run": "Saved run",
      "report.load_insights": "Load Insights",
      "report.generate_pdf": "Generate PDF Report",
      "report.select_run_hint": "Select a saved run and click <strong>Load Insights</strong>.",
      "report.no_insights": "No report insights available for this run.",
      "report.unable_load_insights": "Unable to load insights for selected log.",
      "report.file": "File",
      "report.run_id": "Run ID",
      "report.duration": "Duration",
      "report.rows": "Rows",
      "report.raw_sample_rate": "Raw sample rate",
      "report.speed_coverage": "Speed coverage",
      "report.speed_analysis": "Speed analysis",
      "report.confidence": "confidence {value}",
      "report.missing": "missing",
      "report.no_findings_for_run": "No findings generated for this run.",
      "settings.client_locations": "Client Locations",
      "settings.client_locations_hint":
        "Set location and identify by client. Offline clients can still be assigned.",
      "settings.clients.client": "Client",
      "settings.clients.mac": "MAC Address",
      "settings.clients.location": "Location",
      "settings.clients.identify": "Identify",
      "settings.clients.remove": "Remove",
      "settings.group.vehicle_setup": "Vehicle Setup",
      "settings.group.order_band_widths": "Order Band Widths",
      "settings.group.uncertainty_model": "Uncertainty Model",
      "settings.uncertainty_defaults":
        "Defaults use tire wear from 10/32 in to 2/32 in plus safety margin.",
      "settings.tire_width": "Tire Width (mm)",
      "settings.tire_aspect": "Tire Aspect (%)",
      "settings.rim_size": "Rim Size (in)",
      "settings.final_drive_ratio": "Final Drive Ratio",
      "settings.current_gear_ratio": "Current Gear Ratio",
      "settings.wheel_bandwidth": "Wheel Bandwidth (%)",
      "settings.driveshaft_bandwidth": "Driveshaft Bandwidth (%)",
      "settings.engine_bandwidth": "Engine Bandwidth (%)",
      "settings.min_half_width": "Min Half-width (Hz)",
      "settings.max_half_width": "Max Half-width (%)",
      "settings.speed_uncertainty": "Speed Uncertainty (%)",
      "settings.tire_diameter_uncertainty": "Tire Diameter Uncertainty (%)",
      "settings.final_drive_uncertainty": "Final Drive Uncertainty (%)",
      "settings.gear_slip_uncertainty": "Gear/Slip Uncertainty (%)",
      "settings.save": "Save Settings",
      "settings.no_clients": "No clients detected yet.",
      "settings.select_location": "Select location",
      "status.online": "Online",
      "status.offline": "Offline",
      "status.last_seen": "Last seen: {value}",
      "status.last_seen_none": "Last seen: --",
      "status.dropped": "Dropped frames: {value}",
      "status.frames_total": "Frames total: {value}",
      "status.running": "Running",
      "status.stopped": "Stopped",
      "status.unavailable": "Unavailable",
      "status.current_file": "Current file: {value}",
      "speed.gps": "Speed: {value} m/s (GPS)",
      "speed.override": "Speed: {value} m/s (Override)",
      "speed.none": "Speed: -- m/s",
      "ws.connecting": "WS: connecting...",
      "ws.connected": "WS: connected",
      "ws.reconnecting": "WS: reconnecting...",
      "actions.identify": "Identify",
      "actions.remove": "Remove",
      "actions.remove_client_confirm": "Remove client {id} from the list?",
      "actions.remove_client_failed": "Failed to remove client.",
      "actions.set_location_failed": "Failed to set location.",
      "vibration.none": "No significant vibration events yet.",
      "matrix.amplitude_group": "Amplitude Group",
      "matrix.source.engine": "Engine",
      "matrix.source.driveshaft": "Drive Shaft",
      "matrix.source.wheel": "Wheel/Tire",
      "matrix.source.other": "Other/Road",
      "matrix.severity.l5": "L5 Critical (>=40 dB)",
      "matrix.severity.l4": "L4 Severe (34-40 dB)",
      "matrix.severity.l3": "L3 Elevated (28-34 dB)",
      "matrix.severity.l2": "L2 Moderate (22-28 dB)",
      "matrix.severity.l1": "L1 Slight (16-22 dB)",
      "tooltip.no_events": "No events yet.",
      "tooltip.total_events": "Total events: {count}",
      "tooltip.by_sensor_scope": "By sensor scope:",
      "chart.spectrum_title": "Multi-Sensor Blended Spectrum",
      "chart.axis.hz": "Hz",
      "chart.axis.amplitude": "Amplitude",
      "bands.wheel_1x": "Wheel 1x",
      "bands.wheel_2x": "Wheel 2x",
      "bands.driveshaft_engine_1x": "Driveshaft+Engine 1x",
      "bands.driveshaft_1x": "Driveshaft 1x",
      "bands.engine_1x": "Engine 1x",
      "bands.engine_2x": "Engine 2x",
      "cause.wheel1": "Wheel/Tire imbalance or radial force variation",
      "cause.wheel2": "Tire non-uniformity or wheel resonance",
      "cause.shaft_eng1": "Driveshaft/Engine 1x overlap (same order in current gear)",
      "cause.shaft1": "Drive shaft imbalance or driveline angle issue",
      "cause.eng1": "Engine order vibration (mount/combustion/accessory related)",
      "cause.eng2": "Engine second-order vibration (common in 4-cylinder NVH)",
      "cause.road": "Road input / suspension or body resonance",
      "cause.other": "Further diagnostics needed",
      "msg.multi_detected":
        "Strong multi-sensor vibration detected on {count} sensors [{labels}]. Frequency and amplitude are {hz} Hz and {amp}. Severity: {severity}. Most likely cause: {cause}.",
      "msg.single_detected":
        "Vibration detected by sensor {sensor}. Frequency and amplitude are {hz} Hz and {amp}. Severity: {severity}. Most likely cause: {cause}.",
      "location.front_left_wheel": "Front Left Wheel",
      "location.front_right_wheel": "Front Right Wheel",
      "location.rear_left_wheel": "Rear Left Wheel",
      "location.rear_right_wheel": "Rear Right Wheel",
      "location.transmission": "Transmission",
      "location.driveshaft_tunnel": "Driveshaft Tunnel",
      "location.engine_bay": "Engine Bay",
      "location.front_subframe": "Front Subframe",
      "location.rear_subframe": "Rear Subframe",
      "location.driver_seat": "Driver Seat",
      "location.front_passenger_seat": "Front Passenger Seat",
      "location.rear_left_seat": "Rear Left Seat",
      "location.rear_center_seat": "Rear Center Seat",
      "location.rear_right_seat": "Rear Right Seat",
      "location.trunk": "Trunk",
    },
    nl: {
      "title.main": "VibeSensor Frequentieanalyse Live",
      "nav.live": "Live",
      "nav.logs": "Logs",
      "nav.report": "Rapport",
      "nav.settings": "Instellingen",
      "dashboard.run_logging": "Metrun loggen",
      "dashboard.start_logging": "Logging starten",
      "dashboard.stop_logging": "Logging stoppen",
      "dashboard.speed_override": "Snelheid forceren (km/u)",
      "dashboard.apply_override": "Forcering toepassen",
      "dashboard.detected_vibrations": "Gedetecteerde trillingen",
      "dashboard.vibration_count_live": "Live trillingsteller",
      "dashboard.matrix_note":
        "Niveaus gebruiken dB-banden boven de ruisvloer (L1-L5), gegroepeerd per bron.",
      "logs.refresh": "Logs verversen",
      "logs.table.file": "Bestand",
      "logs.table.updated": "Bijgewerkt",
      "logs.table.size": "Grootte",
      "logs.table.actions": "Acties",
      "logs.none": "Nog geen logbestanden.",
      "logs.none_found": "Geen logs gevonden.",
      "logs.available_count": "{count} logbestand(en) beschikbaar",
      "logs.use_in_report": "Gebruik in rapport",
      "logs.raw": "RAW-log",
      "logs.delete": "Verwijderen",
      "logs.no_available": "Geen logs beschikbaar",
      "logs.delete_confirm": 'Log "{name}" verwijderen? Dit kan niet ongedaan worden gemaakt.',
      "logs.delete_failed": "Verwijderen van log is mislukt.",
      "report.saved_run": "Opgeslagen meetrun",
      "report.load_insights": "Inzichten laden",
      "report.generate_pdf": "PDF-rapport genereren",
      "report.select_run_hint": "Selecteer een opgeslagen meetrun en klik op <strong>Inzichten laden</strong>.",
      "report.no_insights": "Geen rapportinzichten beschikbaar voor deze meetrun.",
      "report.unable_load_insights": "Kan inzichten voor de geselecteerde log niet laden.",
      "report.file": "Bestand",
      "report.run_id": "Run-ID",
      "report.duration": "Duur",
      "report.rows": "Rijen",
      "report.raw_sample_rate": "Bemonsteringsfrequentie",
      "report.speed_coverage": "Snelheidsdekking",
      "report.speed_analysis": "Snelheidsanalyse",
      "report.confidence": "score {value}",
      "report.missing": "ontbreekt",
      "report.no_findings_for_run": "Geen bevindingen gegenereerd voor deze meetrun.",
      "settings.client_locations": "Sensorlocaties",
      "settings.client_locations_hint":
        "Stel per sensor een locatie in en identificeer. Offline sensoren kunnen ook toegewezen worden.",
      "settings.clients.client": "Sensor",
      "settings.clients.mac": "MAC-adres",
      "settings.clients.location": "Locatie",
      "settings.clients.identify": "Identificeer",
      "settings.clients.remove": "Verwijder",
      "settings.group.vehicle_setup": "Voertuiggegevens",
      "settings.group.order_band_widths": "Ordebandbreedtes",
      "settings.group.uncertainty_model": "Onzekerheidsmodel",
      "settings.uncertainty_defaults":
        "Standaardwaarden gebruiken bandenslijtage van 10/32 in tot 2/32 in plus veiligheidsmarge.",
      "settings.tire_width": "Bandbreedte (mm)",
      "settings.tire_aspect": "Bandenprofiel (%)",
      "settings.rim_size": "Velgmaat (inch)",
      "settings.final_drive_ratio": "Eindoverbrenging",
      "settings.current_gear_ratio": "Huidige overbrengingsverhouding",
      "settings.wheel_bandwidth": "Bandbreedte wielorde (%)",
      "settings.driveshaft_bandwidth": "Bandbreedte aandrijfasorde (%)",
      "settings.engine_bandwidth": "Bandbreedte motororde (%)",
      "settings.min_half_width": "Min halve breedte (Hz)",
      "settings.max_half_width": "Max halve breedte (%)",
      "settings.speed_uncertainty": "Snelheidsonzekerheid (%)",
      "settings.tire_diameter_uncertainty": "Banddiameteronzekerheid (%)",
      "settings.final_drive_uncertainty": "Onzekerheid eindoverbrenging (%)",
      "settings.gear_slip_uncertainty": "Versnellings-/sliponzekerheid (%)",
      "settings.save": "Instellingen opslaan",
      "settings.no_clients": "Nog geen sensoren gedetecteerd.",
      "settings.select_location": "Selecteer locatie",
      "status.online": "Online",
      "status.offline": "Offline",
      "status.last_seen": "Laatst gezien: {value}",
      "status.last_seen_none": "Laatst gezien: --",
      "status.dropped": "Verloren frames: {value}",
      "status.frames_total": "Totaal frames: {value}",
      "status.running": "Actief",
      "status.stopped": "Gestopt",
      "status.unavailable": "Niet beschikbaar",
      "status.current_file": "Huidig bestand: {value}",
      "speed.gps": "Snelheid: {value} m/s (GPS)",
      "speed.override": "Snelheid: {value} m/s (Geforceerd)",
      "speed.none": "Snelheid: -- m/s",
      "ws.connecting": "WS: verbinden...",
      "ws.connected": "WS: verbonden",
      "ws.reconnecting": "WS: opnieuw verbinden...",
      "actions.identify": "Identificeer",
      "actions.remove": "Verwijder",
      "actions.remove_client_confirm": "Sensor {id} uit de lijst verwijderen?",
      "actions.remove_client_failed": "Verwijderen van sensor is mislukt.",
      "actions.set_location_failed": "Instellen van locatie is mislukt.",
      "vibration.none": "Nog geen noemenswaardige trillingen.",
      "matrix.amplitude_group": "Amplitudegroep",
      "matrix.source.engine": "Motor",
      "matrix.source.driveshaft": "Aandrijfas",
      "matrix.source.wheel": "Wiel/Band",
      "matrix.source.other": "Overig/Weg",
      "matrix.severity.l5": "L5 Kritiek (>=40 dB)",
      "matrix.severity.l4": "L4 Ernstig (34-40 dB)",
      "matrix.severity.l3": "L3 Verhoogd (28-34 dB)",
      "matrix.severity.l2": "L2 Matig (22-28 dB)",
      "matrix.severity.l1": "L1 Licht (16-22 dB)",
      "tooltip.no_events": "Nog geen gebeurtenissen.",
      "tooltip.total_events": "Totaal gebeurtenissen: {count}",
      "tooltip.by_sensor_scope": "Per sensorbereik:",
      "chart.spectrum_title": "Gemengd spectrum van meerdere sensoren",
      "chart.axis.hz": "Hz",
      "chart.axis.amplitude": "Amplitude",
      "bands.wheel_1x": "Wiel 1x",
      "bands.wheel_2x": "Wiel 2x",
      "bands.driveshaft_engine_1x": "Aandrijfas+Motor 1x",
      "bands.driveshaft_1x": "Aandrijfas 1x",
      "bands.engine_1x": "Motor 1x",
      "bands.engine_2x": "Motor 2x",
      "cause.wheel1": "Wiel/band-onbalans of radiale krachtvariatie",
      "cause.wheel2": "Band-niet-uniformiteit of wielresonantie",
      "cause.shaft_eng1": "Aandrijfas/motor 1x overlap (zelfde orde in huidige versnelling)",
      "cause.shaft1": "Aandrijfas-onbalans of aandrijflijnhoekprobleem",
      "cause.eng1": "Motororde-trilling (steun/verbranding/accessoire-gerelateerd)",
      "cause.eng2": "Tweede orde motortrilling (vaak bij 4-cilinder NVH)",
      "cause.road": "Weginput / ophanging of carrosserieresonantie",
      "cause.other": "Verdere diagnose nodig",
      "msg.multi_detected":
        "Sterke multi-sensor trilling gedetecteerd op {count} sensoren [{labels}]. Frequentie en amplitude zijn {hz} Hz en {amp}. Ernst: {severity}. Meest waarschijnlijke oorzaak: {cause}.",
      "msg.single_detected":
        "Trilling gedetecteerd door sensor {sensor}. Frequentie en amplitude zijn {hz} Hz en {amp}. Ernst: {severity}. Meest waarschijnlijke oorzaak: {cause}.",
      "location.front_left_wheel": "Voorwiel links",
      "location.front_right_wheel": "Voorwiel rechts",
      "location.rear_left_wheel": "Achterwiel links",
      "location.rear_right_wheel": "Achterwiel rechts",
      "location.transmission": "Transmissie",
      "location.driveshaft_tunnel": "Cardantunnel",
      "location.engine_bay": "Motorruimte",
      "location.front_subframe": "Voorste subframe",
      "location.rear_subframe": "Achterste subframe",
      "location.driver_seat": "Bestuurdersstoel",
      "location.front_passenger_seat": "Voorpassagiersstoel",
      "location.rear_left_seat": "Achterstoel links",
      "location.rear_center_seat": "Achterstoel midden",
      "location.rear_right_seat": "Achterstoel rechts",
      "location.trunk": "Kofferbak",
    },
  };

  function normalizeLang(value) {
    const raw = String(value || "").trim().toLowerCase();
    if (raw.startsWith("nl")) return "nl";
    return "en";
  }

  function format(template, vars) {
    if (!vars || typeof vars !== "object") return template;
    return String(template).replace(/\{([a-zA-Z0-9_]+)\}/g, (_m, key) => {
      if (Object.prototype.hasOwnProperty.call(vars, key)) return String(vars[key]);
      return `{${key}}`;
    });
  }

  function get(lang, key, vars) {
    const normalized = normalizeLang(lang);
    const fallback = dict.en?.[key] || key;
    const template = dict[normalized]?.[key] || fallback;
    return format(template, vars);
  }

  function getForAllLangs(key) {
    return supported.map((lang) => get(lang, key));
  }

  window.VibeI18n = {
    supported,
    dict,
    normalizeLang,
    get,
    getForAllLangs,
  };
})();
